<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple TV Media Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            overflow-x: hidden;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
            transition: all 0.3s ease;
        }

        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #007AFF, #0056CC);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg {
            width: 16px;
            height: 16px;
            fill: white;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s, transform 0.2s;
            cursor: pointer;
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 0;
            height: 2px;
            background: #007AFF;
            transition: width 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            color: #fff;
            transform: translateY(-2px);
        }

        .nav-link.active::after {
            width: 100%;
        }

        /* Pages */
        .page {
            display: none;
            padding-top: 70px;
            min-height: 100vh;
        }

        .page.active {
            display: block;
        }

        /* Hero Section */
        .hero {
            height: 80vh;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 0 0 50px 50px;
        }

        .hero-content {
            padding: 0 20px;
        }

        .hero h1 {
            font-size: 4.5em;
            font-weight: 700;
            margin-bottom: 25px;
            background: linear-gradient(45deg, #fff, #ccc, #eee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .hero p {
            font-size: 1.4em;
            color: rgba(255,255,255,0.7);
            margin-bottom: 50px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .upload-btn {
            background: linear-gradient(45deg, #007AFF, #0056CC);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,122,255,0.3);
            min-width: 200px;
        }

        .upload-btn:hover {
            background: linear-gradient(45deg, #0088FF, #0066EE);
            box-shadow: 0 20px 40px rgba(0,122,255,0.25);
            transform: translateY(-2px) scale(1.035);
        }

        /* Library */
        .library-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }

        .library-header {
            margin-bottom: 50px;
            text-align: center;
        }

        .library-title {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #fff, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .library-subtitle {
            color: rgba(255,255,255,0.6);
            font-size: 1.2em;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }

        .video-card {
            background: rgba(255,255,255,0.07);
            border-radius: 20px;
            overflow: hidden;
            transition: box-shadow 0.25s, transform 0.18s;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 5px 24px 0 rgba(0,0,0,0.22);
        }

        .video-card:hover {
            background: rgba(255,255,255,0.16);
            box-shadow: 0 16px 44px 0 rgba(0,0,0,0.35), 0 0px 0px rgba(0,0,0,0);
            transform: scale(1.02) translateY(-2px);
        }

        .video-thumbnail {
            width: 100%;
            height: 180px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .video-thumbnail div { /* Hide placeholder icon when thumbnail is available */
            display: none;
        }

        .video-thumbnail img:not([src="videos/sample-thumbnail.jpg"]) + div {
            display: none; /* Ensure placeholder is hidden for valid thumbnails */
        }

        .video-info {
            padding: 20px;
        }

        .video-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-meta {
            color: rgba(255,255,255,0.6);
            font-size: 0.95em;
            margin-bottom: 15px;
        }

        .video-description {
            color: rgba(255,255,255,0.7);
            font-size: 0.9em;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Player */
        .player-page {
            background: linear-gradient(135deg,#0a0a0a,#1a1a1a);
            min-height: 100vh;
        }

        .video-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 900;
            display: none;
        }

        .video-fullscreen.active {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            padding: 0;
            margin: 0;
            border: none;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 100vw;
            height: 100vh;
            margin: 0;
            background: #000;
            border-radius: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            aspect-ratio: 16 / 9;
        }

        .main-video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            cursor: pointer;
        }

        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .main-video.paused + .video-overlay {
            opacity: 1;
        }

        .video-controls {
            position: absolute;
            left: 50%;
            bottom: 38px;
            transform: translateX(-50%);
            background: rgba(36, 40, 50, 0.32);
            border-radius: 40px;
            box-shadow: 0 2px 40px 0 rgba(0,0,0,0.55);
            padding: 20px 28px 26px 28px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 380px;
            max-width: 98vw;
            z-index: 10;
            opacity: 1;
            transition: opacity 0.4s;
            backdrop-filter: blur(32px) saturate(180%);
            border: 1.5px solid rgba(255,255,255,0.14);
        }

        .video-controls.hide {
            opacity: 0;
            pointer-events: none;
        }

        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
            margin: 5px 0 16px 0;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: #007AFF;
            border-radius: 2px;
            transition: width 0.1s;
        }

        .progress-thumb {
            position: absolute;
            top: 50%;
            left: 0;
            transform: translate(-50%, -50%);
            width: 14px;
            height: 14px;
            background: #007AFF;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 0 3px rgba(0, 122, 255, 0.5);
            transition: transform 0.1s;
            z-index: 2;
        }

        .progress-container:hover .progress-thumb {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .controls-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-btn {
            background: rgba(255,255,255,0.05);
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s, transform 0.18s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.13);
            transform: scale(1.12);
        }

        .play-btn {
            width: 44px;
            height: 44px;
        }

        .time-display {
            color: rgba(255,255,255,0.7);
            font-size: 0.85em;
            min-width: 60px;
            text-align: center;
            font-weight: 500;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 80px;
            height: 3px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            outline: none;
            appearance: none;
            cursor: pointer;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 10px;
            height: 10px;
            background: #007AFF;
            border-radius: 50%;
            cursor: grab;
        }

        .speed-picker-container, .quality-picker-container {
            position: relative;
            display: inline-block;
        }

        .speed-input, .quality-input {
            width: 60px;
            height: 30px;
            background: rgba(255,255,255,0.08);
            border: none;
            border-radius: 15px;
            color: #fff;
            text-align: center;
            font-size: 0.9em;
            padding: 0 8px;
            transition: background 0.2s;
            cursor: pointer;
        }

        .speed-input:focus, .speed-input:hover,
        .quality-input:focus, .quality-input:hover {
            background: rgba(255,255,255,0.15);
        }

        .speed-options, .quality-options {
            display: none;
            position: absolute;
            left: 50%;
            bottom: 105%;
            transform: translateX(-50%);
            background: rgba(30,30,40,0.98);
            border-radius: 12px;
            padding: 7px 0;
            box-shadow: 0 4px 16px rgba(0,0,0,0.25);
            z-index: 30;
            min-width: 90px;
            text-align: center;
            white-space: nowrap;
        }

        .speed-picker-container.open .speed-options,
        .quality-picker-container.open .quality-options {
            display: block;
        }

        .speed-option, .quality-option {
            padding: 8px 16px;
            font-size: 1em;
            color: #fff;
            cursor: pointer;
            border-radius: 6px;
        }

        .speed-option.active, .speed-option:hover,
        .quality-option.active, .quality-option:hover {
            background: rgba(0,122,255,0.15);
        }

        .video-info-panel {
            position: absolute;
            left: 20px;
            top: 60px;
            transform: translateY(0);
            max-width: 340px;
            min-width: 200px;
            background: rgba(30,30,40,0.74);
            backdrop-filter: blur(16px) saturate(130%);
            padding: 18px 22px 16px 22px;
            border-radius: 24px;
            box-shadow: 0 6px 38px 0 rgba(0,0,0,0.28);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.32s cubic-bezier(.28,1.06,.59,1), transform 0.36s cubic-bezier(.28,1.06,.59,1);
            z-index: 40;
        }

        .video-info-panel.show {
            opacity: 1;
            pointer-events: initial;
        }

        .video-info-panel.expanded {
            max-width: 500px;
        }

        .current-title-container {
            display: flex;
            align-items: center;
            margin-bottom: 7px;
        }

        .current-title {
            font-size: clamp(1em, 3vw, 1.35em);
            font-weight: 600;
            color: #fff;
            letter-spacing: -0.01em;
            text-align: left;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .title-toggle {
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            margin-left: 10px;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
        }

        .title-toggle:hover {
            color: #fff;
        }

        .title-toggle svg {
            width: 18px;
            height: 18px;
        }

        .current-meta {
            color: rgba(255,255,255,0.58);
            font-size: 0.92em;
            margin-bottom: 8px;
            text-align: center;
        }

        .current-description {
            color: rgba(255,255,255,0.7);
            font-size: 0.93em;
            line-height: 1.4;
            text-align: center;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .thumbnail-picker-container {
            margin: 20px 0 0 0;
            display: flex;
            align-items: center;
            gap: 18px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .thumbnail-btn {
            border: none;
            background: transparent;
            cursor: pointer;
            outline: none;
            padding: 0;
            border-radius: 10px;
            overflow: hidden;
            transition: box-shadow 0.2s;
        }

        .thumbnail-btn.selected {
            box-shadow: 0 0 0 4px #007AFF;
        }

        .thumbnail-option-img {
            width: 64px;
            height: 40px;
            object-fit: cover;
            display: block;
        }

        /* Upload Area */
        .upload-area {
            border: 3px dashed rgba(255,255,255,0.25);
            border-radius: 30px;
            padding: 80px 40px;
            text-align: center;
            margin: 60px auto;
            max-width: 700px;
            background: rgba(255,255,255,0.06);
            box-shadow: 0 10px 48px 0 rgba(0,0,0,0.34), 0 2px 4px rgba(0,0,0,0.12);
            transition: border 0.26s, background 0.25s, box-shadow 0.25s, transform 0.23s cubic-bezier(.22,1.01,.35,1.05);
            animation: apple-pop-in 0.65s cubic-bezier(.19,.94,.6,1.25);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #007AFF;
            background: rgba(0,122,255,0.10);
            transform: scale(1.025) translateY(-3px);
            box-shadow: 0 18px 70px 0 rgba(0,122,255,0.15), 0 2px 5px rgba(0,0,0,0.12);
        }

        @keyframes apple-pop-in {
            0% { opacity: 0; transform: scale(0.94) translateY(28px);}
            60% { opacity: 1; transform: scale(1.03) translateY(-10px);}
            100% { opacity: 1; transform: scale(1) translateY(0);}
        }

        .upload-icon {
            font-size: 5em;
            margin-bottom: 25px;
            opacity: 0.7;
            color: #007AFF;
            animation: apple-pop-in 0.8s cubic-bezier(.19,.94,.6,1.25);
        }

        .upload-text {
            font-size: 1.3em;
            color: rgba(255,255,255,0.88);
            margin-bottom: 30px;
            animation: apple-pop-in 0.7s cubic-bezier(.19,.94,.6,1.25);
        }

        .file-input {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .video-container {
                height: 100vh;
                max-width: 100%;
                aspect-ratio: 16 / 9;
            }

            .video-controls {
                padding: 12px 8px 16px 8px;
                min-width: unset;
                max-width: 97vw;
            }

            .controls-row {
                flex-wrap: wrap;
                justify-content: center;
            }

            .control-btn, .play-btn {
                width: 32px;
                height: 32px;
            }

            .play-btn {
                width: 40px;
                height: 40px;
            }

            .video-info-panel {
                position: absolute;
                left: 10px;
                top: 10px;
                max-width: 100%;
                transform: none;
            }

            .nav-content {
                padding: 0 20px;
            }

            .nav-links {
                gap: 15px;
            }

            .upload-area {
                padding: 40px 16px;
                margin: 40px 20px;
            }

            .upload-icon {
                font-size: 4em;
            }

            .upload-text {
                font-size: 1em;
            }
        }

        @media (max-width: 500px) {
            .hero h1 {
                font-size: 2.5em;
            }

            .hero p {
                font-size: 1em;
            }

            .video-container {
                height: 100vh;
                aspect-ratio: 16 / 9;
            }

            .controls-row {
                gap: 8px;
            }

            .time-display {
                min-width: 46px;
            }

            .video-controls {
                min-width: 90vw;
                padding: 8px 4px 12px 4px;
            }

            .speed-input, .quality-input {
                width: 48px;
                font-size: 0.88em;
            }

            .speed-options, .quality-options {
                min-width: 70px;
            }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-content">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                </div>
                Media Player
            </div>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-page="home">Home</a>
                <a href="#" class="nav-link" data-page="library">Library</a>
                <a href="#" class="nav-link" data-page="upload">Upload</a>
            </div>
        </div>
    </nav>

    <div class="page active" id="home">
        <div class="hero">
            <div class="hero-content">
                <h1>Your Personal Cinema</h1>
                <p>Experience your media with an Apple TV-inspired interface. Upload videos and enjoy seamless playback.</p>
                <button class="upload-btn" id="getStartedBtn">Get Started</button>
            </div>
        </div>
    </div>

    <div class="page" id="library">
        <div class="library-container">
            <div class="library-header">
                <h2 class="library-title">Your Library</h2>
                <p class="library-subtitle">Discover and play your videos</p>
            </div>
            <div class="video-grid" id="videoGrid"></div>
        </div>
    </div>

    <div class="page" id="upload">
        <div class="library-container">
            <div class="library-header">
                <h2 class="library-title">Upload Videos</h2>
                <p class="library-subtitle">Add videos to your library</p>
            </div>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📁</div>
                <div class="upload-text">Drag and drop videos or click to choose. Supports all video formats.</div>
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Choose Files</button>
                <input type="file" id="fileInput" class="file-input" multiple accept="video/*">
            </div>
        </div>
    </div>

    <div class="page" id="player">
        <div class="video-fullscreen" id="videoFullscreen">
            <div class="video-container" id="videoPlayerContainer">
                <video class="main-video" id="mainVideo" playsinline>
                    <source src="videos/sample.mp4" type="video/mp4">
                </video>
                <div class="video-overlay" id="videoOverlay"></div>
                <div class="video-info-panel" id="videoInfoPanel">
                    <div class="current-title-container">
                        <div class="current-title" id="currentTitle">Video Title</div>
                        <button class="title-toggle" id="titleToggle" title="Expand/Collapse">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="current-meta" id="currentMeta">Duration • Resolution • Size</div>
                    <div class="current-description" id="currentDescription">Video description will appear here.</div>
                </div>
                <div class="thumbnail-picker-container" id="thumbnailPickerContainer"></div>
                <div class="video-controls" id="videoControls">
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-thumb" id="progressThumb"></div>
                    </div>
                    <div class="controls-row">
                        <button class="control-btn" id="rewindBtn" title="Rewind 10s">
                            <svg viewBox="0 0 24 24">
                                <path d="M11 19l-7-7 7-7m5 14l-7-7 7-7"/>
                            </svg>
                        </button>
                        <button class="control-btn play-btn" id="playBtn" title="Play/Pause">
                            <svg viewBox="0 0 24 24">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                        </button>
                        <button class="control-btn" id="fastForwardBtn" title="Fast Forward 10s">
                            <svg viewBox="0 0 24 24">
                                <path d="M13 19l7-7-7-7m-5 14l7-7-7-7"/>
                            </svg>
                        </button>
                        <span class="speed-picker-container" id="speedPickerContainer">
                            <input type="text" class="speed-input" id="speedInput" value="1.0" readonly title="Playback Speed">
                            <div class="speed-options" id="speedOptions">
                                <div class="speed-option" data-speed="0.5">0.5x</div>
                                <div class="speed-option" data-speed="1.0">1.0x</div>
                                <div class="speed-option" data-speed="1.5">1.5x</div>
                                <div class="speed-option" data-speed="2.0">2.0x</div>
                            </div>
                        </span>
                        <span class="quality-picker-container" id="qualityPickerContainer">
                            <input type="text" class="quality-input" id="qualityInput" value="Auto" readonly title="Video Quality">
                            <div class="quality-options" id="qualityOptions">
                                <div class="quality-option" data-quality="auto">Auto</div>
                                <div class="quality-option" data-quality="2160">4K</div>
                                <div class="quality-option" data-quality="1080">1080p</div>
                                <div class="quality-option" data-quality="720">720p</div>
                                <div class="quality-option" data-quality="480">480p</div>
                            </div>
                        </span>
                        <div class="volume-container">
                            <button class="control-btn" id="volumeBtn" title="Mute/Unmute">
                                <svg viewBox="0 0 24 24">
                                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                </svg>
                            </button>
                            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100">
                        </div>
                        <button class="control-btn" id="fullscreenBtn" title="Fullscreen">
                            <svg viewBox="0 0 24 24">
                                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                            </svg>
                        </button>
                        <div class="time-display" id="timeDisplay">0:00 / 0:00</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showCustomMessage(title, message) {
            alert(title + ": " + message);
        }

        class AppleTVPlayer {
            constructor() {
                this.videos = [{
                    id: Date.now() + Math.random(),
                    name: 'Sample Video.mp4',
                    size: 50 * 1024 * 1024,
                    type: 'video/mp4',
                    url: 'videos/sample.mp4',
                    duration: 120,
                    width: 1920,
                    height: 1080,
                    thumbnail: 'videos/sample-thumbnail.jpg',
                    description: 'A sample video for testing.',
                    isPlayable: true,
                    thumbnails: []
                }];
                this.currentVideoIndex = -1;
                this.isPlaying = false;
                this.isDraggingProgress = false;
                this.lastVolume = 1;
                this.playbackSpeed = 1.0;
                this.videoQuality = 'auto';
                this.controlsTimeout = null;
                this.controlsVisible = true;
                this.selectedThumbnailTime = 0;
                this.infoPanelTimeout = null;
                this.infoPanelActive = false;
                this.infoPanelExpanded = false;
                this.wasPlayingBeforeSeek = false;
                this.initializeElements();
                this.bindEvents();
                this.renderLibrary();
            }

            initializeElements() {
                this.navLinks = document.querySelectorAll('.nav-link');
                this.mainVideo = document.getElementById('mainVideo');
                this.videoGrid = document.getElementById('videoGrid');
                this.fileInput = document.getElementById('fileInput');
                this.uploadArea = document.getElementById('uploadArea');
                this.videoPlayerContainer = document.getElementById('videoPlayerContainer');
                this.videoFullscreen = document.getElementById('videoFullscreen');
                this.videoControls = document.getElementById('videoControls');
                this.videoOverlay = document.getElementById('videoOverlay');
                this.playBtn = document.getElementById('playBtn');
                this.rewindBtn = document.getElementById('rewindBtn');
                this.fastForwardBtn = document.getElementById('fastForwardBtn');
                this.speedInput = document.getElementById('speedInput');
                this.speedPickerContainer = document.getElementById('speedPickerContainer');
                this.speedOptions = document.getElementById('speedOptions');
                this.qualityInput = document.getElementById('qualityInput');
                this.qualityPickerContainer = document.getElementById('qualityPickerContainer');
                this.qualityOptions = document.getElementById('qualityOptions');
                this.volumeBtn = document.getElementById('volumeBtn');
                this.volumeSlider = document.getElementById('volumeSlider');
                this.fullscreenBtn = document.getElementById('fullscreenBtn');
                this.progressContainer = document.getElementById('progressContainer');
                this.progressBar = document.getElementById('progressBar');
                this.progressThumb = document.getElementById('progressThumb');
                this.timeDisplay = document.getElementById('timeDisplay');
                this.currentTitle = document.getElementById('currentTitle');
                this.currentMeta = document.getElementById('currentMeta');
                this.currentDescription = document.getElementById('currentDescription');
                this.thumbnailPickerContainer = document.getElementById('thumbnailPickerContainer');
                this.infoPanel = document.getElementById('videoInfoPanel');
                this.titleToggle = document.getElementById('titleToggle');
                this.updatePlaySVG();
            }

            bindEvents() {
                this.navLinks.forEach(link => link.addEventListener('click', e => {
                    e.preventDefault();
                    this.showPage(link.dataset.page);
                }));

                this.fileInput.addEventListener('change', e => this.handleFiles(e.target.files));

                this.uploadArea.addEventListener('dragover', e => {
                    e.preventDefault();
                    this.uploadArea.classList.add('dragover');
                });

                this.uploadArea.addEventListener('dragleave', e => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                });

                this.uploadArea.addEventListener('drop', e => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                    this.handleFiles(e.dataTransfer.files);
                });

                this.playBtn.addEventListener('click', () => this.togglePlay());
                this.rewindBtn.addEventListener('click', () => this.rewind());
                this.fastForwardBtn.addEventListener('click', () => this.fastForward());

                this.speedInput.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.speedPickerContainer.classList.toggle('open');
                });

                this.qualityInput.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.qualityPickerContainer.classList.toggle('open');
                });

                document.addEventListener('click', (e) => {
                    if (!this.speedPickerContainer.contains(e.target)) this.speedPickerContainer.classList.remove('open');
                    if (!this.qualityPickerContainer.contains(e.target)) this.qualityPickerContainer.classList.remove('open');
                });

                this.speedOptions.querySelectorAll('.speed-option').forEach(option => option.addEventListener('click', (e) => {
                    this.updateSpeed(option.dataset.speed);
                }));

                this.qualityOptions.querySelectorAll('.quality-option').forEach(option => option.addEventListener('click', (e) => {
                    this.updateQuality(option.dataset.quality);
                }));

                this.volumeBtn.addEventListener('click', () => this.toggleMute());
                this.volumeSlider.addEventListener('input', e => this.setVolume(e.target.value / 100));
                this.fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());

                this.mainVideo.addEventListener('click', () => this.togglePlay());

                this.progressContainer.addEventListener('mousedown', e => this.startSeek(e));
                document.addEventListener('mousemove', e => this.duringSeek(e));
                document.addEventListener('mouseup', () => this.endSeek());

                this.progressContainer.addEventListener('touchstart', e => this.startSeek(e));
                document.addEventListener('touchmove', e => this.duringSeek(e));
                document.addEventListener('touchend', () => this.endSeek());

                this.progressThumb.addEventListener('mousedown', e => {
                    e.stopPropagation();
                    this.startSeek(e);
                });

                this.progressThumb.addEventListener('touchstart', e => {
                    e.stopPropagation();
                    this.startSeek(e);
                });

                this.mainVideo.addEventListener('loadedmetadata', () => this.updateVideoInfo());
                this.mainVideo.addEventListener('timeupdate', () => this.updateProgress());
                this.mainVideo.addEventListener('ended', () => this.playNext());
                this.mainVideo.addEventListener('play', () => this.updatePlayButton());
                this.mainVideo.addEventListener('pause', () => this.updatePlayButton());
                this.mainVideo.addEventListener('volumechange', () => this.updateVolumeButton());

                document.addEventListener('keydown', e => this.handleKeyboard(e));

                this.videoPlayerContainer.addEventListener('mousemove', () => {
                    this.showControls(true);
                    this.showInfoPanel();
                });

                this.videoPlayerContainer.addEventListener('mouseleave', () => {
                    this.hideControls();
                    this.hideInfoPanel();
                });

                this.videoPlayerContainer.addEventListener('touchstart', () => {
                    this.showControls(true);
                    this.showInfoPanel();
                });

                window.addEventListener('beforeunload', () => this.cleanup());
                this.mainVideo.addEventListener('play', () => {
                    this.showInfoPanel();
                });

                this.titleToggle.addEventListener('click', () => this.toggleTitleExpansion());
            }

            showPage(pageName) {
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                document.getElementById(pageName).classList.add('active');
                this.navLinks.forEach(link => link.classList.toggle('active', link.dataset.page === pageName));

                if (pageName !== 'player' && !this.mainVideo.paused) this.mainVideo.pause();
                if (pageName === 'player') this.videoFullscreen.classList.add('active');
                else this.videoFullscreen.classList.remove('active');
            }

            handleFiles(files) {
                const videoFiles = Array.from(files).filter(file => file.size <= 2 * 1024 * 1024 * 1024 && file.type.startsWith('video/'));
                if (videoFiles.length === 0) {
                    showCustomMessage('No Files', 'Please select valid video files.');
                    return;
                }
                videoFiles.forEach(file => this.addVideo(file));
                this.renderLibrary();
                this.showPage('library');
            }

            addVideo(file) {
                const video = {
                    id: Date.now() + Math.random(),
                    file,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    url: URL.createObjectURL(file),
                    duration: 0,
                    width: 0,
                    height: 0,
                    thumbnail: '',
                    description: this.generateDescription(file.name),
                    isPlayable: this.checkPlayable(file.type),
                    thumbnails: []
                };

                this.generateRandomThumbnail(video).then(thumb => {
                    video.thumbnail = thumb || 'videos/sample-thumbnail.jpg';
                    this.renderLibrary();
                });

                this.videos.push(video);
            }

            async generateRandomThumbnail(video) {
                return new Promise(resolve => {
                    const v = document.createElement('video');
                    v.src = video.url;
                    v.muted = true;
                    v.currentTime = 0;

                    v.addEventListener('loadedmetadata', () => {
                        let dur = v.duration;
                        let t = Math.random() * dur;
                        v.currentTime = t;

                        v.addEventListener('seeked', () => {
                            const c = document.createElement('canvas');
                            c.width = 128;
                            c.height = 72;
                            c.getContext('2d').drawImage(v, 0, 0, 128, 72);
                            resolve(c.toDataURL('image/jpeg', 0.6));
                        }, {
                            once: true
                        });
                    }, {
                        once: true
                    });

                    v.addEventListener('error', () => resolve(''), {
                        once: true
                    });
                });
            }

            checkPlayable(mimeType) {
                return ['probably', 'maybe'].includes(document.createElement('video').canPlayType(mimeType));
            }

            cleanup() {
                this.videos.forEach(video => video.url && URL.revokeObjectURL(video.url));
                this.videos = [];
                this.renderLibrary();
            }

            renderLibrary() {
                if (this.videos.length === 0) {
                    this.videoGrid.innerHTML = '<div class="empty-state"><div class="icon">🎬</div><h3>No videos yet</h3><p>Upload some videos to get started.</p></div>';
                    return;
                }

                this.videoGrid.innerHTML = this.videos.map((video, index) => `
                    <div class="video-card" data-index="${index}">
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail||'videos/sample-thumbnail.jpg'}" alt="${video.name}">
                            <div style="font-size:3em;color:#007AFF;">🎥</div>
                        </div>
                        <div class="video-info">
                            <div class="video-title">${this.formatFileName(video.name)}</div>
                            <div class="video-meta">${this.formatDuration(video.duration)} • ${this.formatFileSize(video.size)}</div>
                            <div class="video-description">${video.description}</div>
                        </div>
                    </div>
                `).join('');

                this.videoGrid.querySelectorAll('.video-card').forEach(card => {
                    const img = card.querySelector('img');
                    if (img && img.src) img.addEventListener('load', () => card.classList.add('loaded'));
                    card.addEventListener('click', () => this.playVideo(parseInt(card.dataset.index)));
                });
            }

            playVideo(index) {
                if (index < 0 || index >= this.videos.length) return;
                const video = this.videos[index];
                if (!video.isPlayable) {
                    showCustomMessage('Unsupported Video', `"${video.name}" is unsupported.`);
                    return;
                }
                this.currentVideoIndex = index;
                this.mainVideo.src = video.url;
                this.mainVideo.playbackRate = this.playbackSpeed;
                this.mainVideo.preload = 'auto';
                this.mainVideo.load();
                this.currentTitle.textContent = this.formatFileName(video.name);
                this.currentMeta.textContent = `${this.formatDuration(video.duration)} • ${this.formatFileSize(video.size)} ${video.width?`• ${video.width}x${video.height}`:''}`;
                this.currentDescription.textContent = video.description;
                this.showPage('player');
                this.mainVideo.play().catch(() => {});
                this.mainVideo.addEventListener('canplay', () => {
                    this.updateVideoInfo();
                    this.generateThumbnails(this.currentVideoIndex);
                    this.showInfoPanel();
                }, {
                    once: true
                });
                this.mainVideo.addEventListener('error', () => showCustomMessage('Video Error', `Failed to load "${video.name}".`), {
                    once: true
                });
            }

            togglePlay() {
                if (this.mainVideo.paused) this.mainVideo.play();
                else this.mainVideo.pause();
                this.showControls(true);
                this.showInfoPanel();
            }

            rewind() {
                this.mainVideo.currentTime = Math.max(0, this.mainVideo.currentTime - 10);
            }

            fastForward() {
                this.mainVideo.currentTime = Math.min(this.mainVideo.duration, this.mainVideo.currentTime + 10);
            }

            updateSpeed(speed) {
                const parsedSpeed = parseFloat(speed);
                if (!isNaN(parsedSpeed) && parsedSpeed > 0 && parsedSpeed <= 4.0) {
                    this.playbackSpeed = parsedSpeed;
                    this.mainVideo.playbackRate = this.playbackSpeed;
                    this.speedInput.value = this.playbackSpeed.toString();
                    this.speedOptions.querySelectorAll('.speed-option').forEach(option => {
                        option.classList.toggle('active', option.dataset.speed == this.playbackSpeed);
                    });
                    this.speedPickerContainer.classList.remove('open');
                }
            }

            updateQuality(quality) {
                this.videoQuality = quality;
                this.qualityInput.value = quality === 'auto' ? 'Auto' : `${quality}p`;
                this.qualityOptions.querySelectorAll('.quality-option').forEach(option => {
                    option.classList.toggle('active', option.dataset.quality == this.videoQuality);
                });
                this.qualityPickerContainer.classList.remove('open');
                // In a real implementation, this would trigger adaptive streaming ye boy
            }

            toggleMute() {
                this.mainVideo.muted = !this.mainVideo.muted;
                this.lastVolume = this.mainVideo.muted ? 0 : this.lastVolume || 1;
                this.volumeSlider.value = this.mainVideo.muted ? 0 : this.lastVolume * 100;
                this.updateVolumeButton();
                this.showControls(true);
            }

            setVolume(value) {
                this.mainVideo.volume = value;
                this.mainVideo.muted = value === 0;
                this.lastVolume = value;
                this.updateVolumeButton();
                this.showControls(true);
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) this.videoPlayerContainer.requestFullscreen().catch(() => showCustomMessage('Fullscreen Error', 'Fullscreen not available.'));
                else document.exitFullscreen();
            }

            startSeek(e) {
                this.isDraggingProgress = true;
                this.wasPlayingBeforeSeek = !this.mainVideo.paused;
                this.seek(e);
                if (this.wasPlayingBeforeSeek) this.mainVideo.pause();
                this.showControls(true);
            }

            duringSeek(e) {
                if (this.isDraggingProgress) {
                    this.seek(e);
                }
            }

            endSeek() {
                if (this.isDraggingProgress) {
                    this.isDraggingProgress = false;
                    if (this.wasPlayingBeforeSeek) this.mainVideo.play();
                }
            }

            seek(e) {
                const rect = this.progressContainer.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const percent = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
                this.mainVideo.currentTime = percent * this.mainVideo.duration;
                this.updateProgress();
            }

            updateProgress() {
                if (!this.mainVideo.duration) return;
                const percent = (this.mainVideo.currentTime / this.mainVideo.duration);
                this.progressBar.style.width = `${percent*100}%`;
                this.progressThumb.style.left = `calc(${percent*100}% )`;
                this.timeDisplay.textContent = `${this.formatTime(this.mainVideo.currentTime)} / ${this.formatTime(this.mainVideo.duration)}`;
            }

            updatePlayButton() {
                this.isPlaying = !this.mainVideo.paused;
                this.updatePlaySVG();
            }

            updatePlaySVG() {
                this.playBtn.innerHTML = this.mainVideo.paused ?
                    '<svg viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"/></svg>' :
                    '<svg viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>';

                this.videoOverlay.innerHTML = this.mainVideo.paused ?
                    '<svg viewBox="0 0 24 24" style="transform: scale(3);"><polygon points="5 3 19 12 5 21 5 3"/></svg>' :
                    '';
            }

            updateVolumeButton() {
                this.volumeBtn.innerHTML = this.mainVideo.muted || this.mainVideo.volume === 0 ?
                    '<svg viewBox="0 0 24 24"><path d="M11 5L6 9H2v6h4l5 4V5z"/></svg>' :
                    this.mainVideo.volume < 0.5 ?
                    '<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>' :
                    '<svg viewBox="0 0 24 24"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/></svg>';
            }

            updateVideoInfo() {
                const video = this.videos[this.currentVideoIndex];
                if (video) {
                    video.duration = this.mainVideo.duration || video.duration;
                    video.width = this.mainVideo.videoWidth || video.width;
                    video.height = this.mainVideo.videoHeight || video.height;
                    this.currentMeta.textContent = `${this.formatDuration(video.duration)} • ${this.formatFileSize(video.size)} ${video.width?`• ${video.width}x${video.height}`:''}`;
                    this.updateProgress();
                }
            }

            handleKeyboard(e) {
                if (!document.getElementById('player').classList.contains('active')) return;
                switch (e.code) {
                    case 'Space':
                        e.preventDefault();
                        this.togglePlay();
                        break;
                    case 'ArrowLeft':
                        this.rewind();
                        break;
                    case 'ArrowRight':
                        this.fastForward();
                        break;
                    case 'ArrowUp':
                        this.setVolume(Math.min(1, this.mainVideo.volume + 0.1));
                        break;
                    case 'ArrowDown':
                        this.setVolume(Math.max(0, this.mainVideo.volume - 0.1));
                        break;
                    case 'KeyM':
                        this.toggleMute();
                        break;
                    case 'KeyF':
                        this.toggleFullscreen();
                        break;
                    case 'Escape':
                        if (document.fullscreenElement) document.exitFullscreen();
                }
                this.showControls(true);
                this.showInfoPanel();
            }

            formatTime(seconds) {
                if (isNaN(seconds) || seconds < 0) return '0:00';
                const m = Math.floor(seconds / 60);
                const s = Math.floor(seconds % 60);
                return `${m}:${String(s).padStart(2,'0')}`;
            }

            formatDuration(seconds) {
                return this.formatTime(seconds);
            }

            formatFileSize(bytes) {
                if (!bytes) return '';
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return `${(bytes/Math.pow(1024,i)).toFixed(2)} ${['B','KB','MB','GB','TB'][i]}`;
            }

            formatFileName(fileName) {
                if (!fileName) return '';
                return fileName.substring(0, fileName.lastIndexOf('.'));
            }

            generateDescription(fileName) {
                return `A video titled "${this.formatFileName(fileName)}". Enjoy a premium viewing experience.`;
            }

            playNext() {
                if (this.videos.length === 0) return;
                let nextIndex = (this.currentVideoIndex + 1) % this.videos.length;
                while (!this.videos[nextIndex].isPlayable && nextIndex !== this.currentVideoIndex) {
                    nextIndex = (nextIndex + 1) % this.videos.length;
                }
                this.playVideo(nextIndex);
            }

            showControls(force) {
                clearTimeout(this.controlsTimeout);
                if (!this.controlsVisible || force) {
                    this.videoControls.classList.remove('hide');
                    this.controlsVisible = true;
                }
                if (!this.mainVideo.paused) {
                    this.controlsTimeout = setTimeout(() => {
                        if (this.controlsVisible) this.hideControls();
                    }, 2600);
                }
            }

            hideControls() {
                if (this.mainVideo.paused) return;
                this.videoControls.classList.add('hide');
                this.controlsVisible = false;
            }

            async generateThumbnails(index) {
                const video = this.videos[index];
                if (!video || video.thumbnails.length > 0 || !video.url) {
                    this.renderThumbnailPicker();
                    return;
                }

                try {
                    let v = document.createElement('video');
                    v.src = video.url;
                    v.muted = true;
                    await v.play().catch(() => {});
                    await new Promise(res => v.addEventListener('loadedmetadata', res, {
                        once: true
                    }));

                    let duration = v.duration;
                    let steps = Math.min(6, Math.max(2, Math.floor(duration / 20)));
                    let thumbs = [];
                    let canvas = document.createElement('canvas');
                    let w = 128;
                    let h = 72;
                    canvas.width = w;
                    canvas.height = h;

                    for (let s = 0; s < steps; s++) {
                        let t = (duration * s) / (steps);
                        v.currentTime = t;
                        await new Promise(res => v.addEventListener('seeked', res, {
                            once: true
                        }));
                        canvas.getContext('2d').drawImage(v, 0, 0, w, h);
                        thumbs.push({
                            url: canvas.toDataURL('image/jpeg', 0.6),
                            time: t
                        });
                    }

                    video.thumbnails = thumbs;
                    this.renderThumbnailPicker();
                } catch {
                    video.thumbnails = [];
                    this.renderThumbnailPicker();
                }
            }

            renderThumbnailPicker() {
                const video = this.videos[this.currentVideoIndex];
                if (!video || !video.thumbnails.length) {
                    this.thumbnailPickerContainer.innerHTML = '';
                    return;
                }

                let html = video.thumbnails.map((thumb, idx) =>
                    `<button class="thumbnail-btn${this.selectedThumbnailTime===thumb.time?' selected':''}" data-idx="${idx}"><img class="thumbnail-option-img" src="${thumb.url}" /></button>`
                ).join('');

                this.thumbnailPickerContainer.innerHTML = html;
                this.thumbnailPickerContainer.querySelectorAll('.thumbnail-btn').forEach(btn => {
                    btn.onclick = () => this.handleThumbnailSelect(parseInt(btn.dataset.idx));
                });
            }

            handleThumbnailSelect(idx) {
                const video = this.videos[this.currentVideoIndex];
                if (!video || !video.thumbnails[idx]) return;
                this.selectedThumbnailTime = video.thumbnails[idx].time;
                video.thumbnail = video.thumbnails[idx].url;
                this.renderThumbnailPicker();
            }

            showInfoPanel() {
                clearTimeout(this.infoPanelTimeout);
                if (this.infoPanel.classList.contains('show')) {
                    this.infoPanelTimeout = setTimeout(() => this.hideInfoPanel(), 2750);
                    return;
                }
                this.infoPanel.classList.add('show');
                this.infoPanelTimeout = setTimeout(() => this.hideInfoPanel(), 2750);
            }

            hideInfoPanel() {
                clearTimeout(this.infoPanelTimeout);
                this.infoPanel.classList.remove('show');
            }

            toggleTitleExpansion() {
                this.infoPanelExpanded = !this.infoPanelExpanded;
                this.infoPanel.classList.toggle('expanded', this.infoPanelExpanded);

                this.titleToggle.innerHTML = this.infoPanelExpanded ?
                    '<svg viewBox="0 0 24 24"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"/></svg>' :
                    '<svg viewBox="0 0 24 24"><path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"/></svg>';

                // Clear any existing timeout and set a new one, cuz it will be weird if not lol
                clearTimeout(this.infoPanelTimeout);
                this.infoPanelTimeout = setTimeout(() => this.hideInfoPanel(), 2750);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const player = new AppleTVPlayer();
            document.getElementById('getStartedBtn').addEventListener('click', () => player.showPage('upload'));
        });
    </script>
</body>
</html>
